# Документация системы управления игрой

## Как настроить игру в Unity

### 1. Начальная настройка сцены

#### Создание основной сетки:
1. Создайте пустой GameObject и назовите его "Grid"
2. Добавьте компонент Grid (Component → Layout → Grid)
3. Настройте размер ячеек (Cell Size: 1x1x1)
4. Создайте дочерний объект "GridSurface" с компонентом Sprite Renderer для визуализации поверхности

#### Настройка камеры:
1. Выберите Main Camera
2. Установите Orthographic проекцию
3. Позиция камеры: X=0, Y=10, Z=0
4. Поворот камеры: X=90, Y=0, Z=0
5. Размер камеры: настройте в зависимости от размера сетки

### 2. Настройка робота

#### Создание префаба робота:
1. Создайте 3D объект (например, куб) и назовите его "Robot"
2. Добавьте компонент RobotController.cs
3. Настройте визуальное представление (спрайт или 3D модель)
4. Добавьте компонент Collider для обнаружения столкновений
5. Преобразуйте в префаб и поместите в папку Prefabs

#### Параметры RobotController:
- Speed: 2.0 (скорость движения)
- RotationSpeed: 5.0 (скорость поворота)
- JumpForce: 8.0 (сила прыжка)

### 3. Настройка системы управления уровнями

#### Создание LevelManager:
1. Создайте пустой GameObject и назовите его "LevelManager"
2. Добавьте компонент LevelManager.cs
3. В инспекторе создайте массив уровней
4. Настройте ссылки на UI элементы (LevelCompletePanel, etc.)

#### Создание LevelData ScriptableObjects:
1. Щелкните правой кнопкой мыши в папке Resources/Levels
2. Выберите Create → Robot Coder → Level Data
3. Настройте параметры уровня:
   - Level Index: порядковый номер уровня
   - Level Name: название уровня
   - Grid Size: размер игровой сетки
   - Robot Start Position: начальная позиция робота
   - Robot Start Rotation: начальный поворот робота
   - Goal Positions: позиции целей
   - Wall Positions: позиции стен
   - Available Commands: доступные команды для уровня

### 4. Настройка системы программирования

#### Создание палитры команд:
1. Создайте UI Canvas
2. Добавьте панель и назовите её "BlockPalette"
3. Добавьте компонент BlockPalette.cs
4. Создайте кнопки для каждой команды:
   - MoveForwardButton
   - TurnLeftButton
   - TurnRightButton
   - JumpButton
   - InteractButton
5. Для каждой кнопки добавьте компонент CommandBlock.cs с соответствующим типом

#### Создание рабочей области:
1. В Canvas создайте панель "WorkspacePanel"
2. Добавьте компонент WorkspacePanel.cs
3. Создайте дочерние объекты DropZone для каждой позиции команды
4. Добавьте компонент DropZone.cs к каждой зоне

#### Настройка интерпретатора:
1. Создайте пустой GameObject "ProgramInterpreter"
2. Добавьте компонент ProgramInterpreter.cs
3. Настройте ссылки на RobotController и WorkspacePanel

### 5. Настройка пользовательского интерфейса

#### Создание главного меню:
1. Создайте Canvas с MainMenuManager.cs
2. Добавьте кнопки:
   - StartButton: запуск игры
   - LevelSelectButton: выбор уровня
   - SettingsButton: настройки
   - QuitButton: выход

#### Создание игрового интерфейса:
1. Создайте Canvas с GameUIController.cs
2. Добавьте элементы:
   - LevelText: отображение текущего уровня
   - CommandCountText: счетчик команд
   - StartButton: запуск программы
   - ResetButton: сброс программы
   - PauseButton: пауза
   - ContinueButton: продолжить
   - MenuButton: возврат в меню

#### Создание экрана завершения уровня:
1. Создайте панель LevelCompletePanel
2. Добавьте элементы:
   - LevelCompleteText: сообщение о завершении
   - StarsDisplay: отображение звезд
   - ContinueButton: следующий уровень
   - RetryButton: повторить уровень
   - MenuButton: в меню

### 6. Настройка GameManager

#### Создание основного менеджера:
1. Создайте пустой GameObject "GameManager"
2. Добавьте компонент GameManager.cs
3. Настройте ссылки в инспекторе:
   - LevelManager
   - ProgramInterpreter
   - RobotController
   - UI элементы

#### Основные параметры:
- StartingLevel: начальный уровень (0)
- MaxCommands: максимальное количество команд
- EnableDebug: включение отладки

### 7. Настройка системы сохранений

#### Создание SaveManager:
1. Создайте пустой GameObject "SaveManager"
2. Добавьте компонент SaveManager.cs
3. Настройте параметры:
   - SaveFileName: имя файла сохранения
   - AutoSave: автоматическое сохранение

## Пошаговая настройка уровней

### Уровень 1 (Обучение):
1. Создайте LevelData объект
2. Установите Level Index = 1
3. Grid Size = 5x5
4. Robot Start Position = (0,0)
5. Robot Start Rotation = 0 (вправо)
6. Goal Position = (4,0)
7. Доступные команды: только MoveForward

### Уровень 2 (Повороты):
1. Создайте LevelData объект
2. Установите Level Index = 2
3. Grid Size = 7x7
4. Robot Start Position = (0,0)
5. Robot Start Rotation = 0 (вправо)
6. Goal Position = (0,3)
7. Доступные команды: MoveForward, TurnLeft, TurnRight

### Уровень 3 (Прыжки):
1. Создайте LevelData объект
2. Установите Level Index = 3
3. Grid Size = 8x8
4. Robot Start Position = (0,0)
5. Robot Start Rotation = 0 (вправо)
6. Goal Position = (7,0)
7. Добавьте стену на (3,0)
8. Доступные команды: MoveForward, TurnLeft, TurnRight, Jump

## Настройка системы перетаскивания

### Настройка DragDropHandler:
1. Добавьте компонент DragDropHandler.cs к каждому CommandBlock
2. Настройте параметры:
   - DragThreshold: 10 (минимальное расстояние для начала перетаскивания)
   - DragSpeed: 5.0 (скорость следования за курсором)

### Настройка DropZone:
1. Добавьте компонент DropZone.cs к каждой зоне в WorkspacePanel
2. Настройте параметры:
   - AcceptMultiple: false (принимать только один блок)
   - HighlightColor: цвет подсветки при наведении

## Настройка анимаций

### Анимация робота:
1. Создайте Animator Controller для робота
2. Добавьте параметры:
   - Speed (float)
   - IsMoving (bool)
   - IsJumping (bool)
   - IsTurning (bool)
3. Создайте переходы между анимациями
4. Настройте Blend Trees для плавных переходов

### Анимация UI:
1. Используйте Animation компонент для UI элементов
2. Создайте анимации для:
   - Появления/исчезновения панелей
   - Подсветки кнопок
   - Анимации звезд при завершении уровня

## Отладка и тестирование

### Горячие клавиши для тестирования:
- **F1** - Показать состояние всех систем
- **Пробел** - Старт/Стоп программы
- **R** - Сброс программы
- **Esc** - Пауза
- **F5** - Сохранить прогресс
- **F9** - Загрузить прогресс

### Рекомендации по тестированию:
1. Проверьте все уровни на проходимость
2. Убедитесь, что все команды работают корректно
3. Проверьте граничные условия (выход за пределы сетки)
4. Протестируйте систему сохранений
5. Проверьте корректность отображения UI на разных разрешениях

## Расширение функциональности

### Добавление новых команд:
1. Создайте новый класс, наследующий CommandBlock
2. Реализуйте метод Execute с логикой команды
3. Добавьте команду в палитру блоков
4. Настройте локализацию названия команды

### Создание новых типов уровней:
1. Создайте новый класс, наследующий LevelData
2. Переопределите методы для специфической логики уровня
3. Добавьте новые параметры в инспектор
4. Создайте соответствующие префабы

### Расширение UI:
1. Создайте новые компоненты в папке UI
2. Используйте существующие менеджеры как пример
3. Подключите к соответствующим игровым системам
4. Протестируйте на разных размерах экрана

## Решение проблем

### Проблема: Игра остается на паузе при выходе в меню
**Решение:** Добавлен метод ResumeGame() который сбрасывает Time.timeScale = 1f

### Проблема: Утечка памяти при переходах
**Решение:** 
- Добавлены методы очистки слушателей событий (ClearEventListeners)
- Все события отписываются в OnDestroy и OnDisable
- Корутины останавливаются при уничтожении объектов

### Проблема: Блоки не перетаскиваются
**Решение:**
- Проверьте наличие компонента DragDropHandler
- Убедитесь, что Canvas использует правильный Render Mode
- Проверьте EventSystem в сцене

### Проблема: Робот не двигается
**Решение:**
- Проверьте компонент RobotController
- Убедитесь, что ProgramInterpreter получает команды
- Проверьте настройки физики (если используется)

## Рекомендации по использованию

1. **При разработке новых компонентов:**
   - Всегда отписывайтесь от событий в OnDestroy и OnDisable
   - Останавливайте корутины при уничтожении объектов
   - Используйте null-проверки для всех ссылок

2. **При добавлении новых команд:**
   - Создавайте наследников от CommandBlock
   - Реализуйте метод Execute с логикой команды
   - Добавьте локализацию названия команды

3. **При работе с UI:**
   - Используйте ClearEventListeners перед добавлением новых слушателей
   - Проверяйте существование компонентов перед использованием
   - Обновляйте визуальные элементы при изменении состояния

4. **При настройке уровней:**
   - Тестируйте каждый уровень отдельно
   - Убедитесь в корректности координат
   - Проверяйте достижимость всех целей