# Документация системы управления игрой

## Основные компоненты системы

### 1. GameManager
**Назначение:** Центральный менеджер игры, координирует работу всех систем.

**Основные функции:**
- Управление состоянием игры (старт, пауза, сброс)
- Переход между уровнями
- Координация взаимодействия между компонентами

### 2. LevelManager
**Назначение:** Управление уровнями игры.

**Основные функции:**
- Загрузка и инициализация уровней
- Отслеживание завершения уровней
- Разблокировка следующих уровней

### 3. RobotController
**Назначение:** Управление роботом в игре.

**Основные функции:**
- Выполнение команд (движение, повороты, прыжки)
- Проверка условий (на цели, препятствия)
- Анимация движений

### 4. ProgramInterpreter
**Назначение:** Интерпретатор программ, созданных игроком.

**Основные функции:**
- Выполнение последовательности команд
- Пауза и остановка выполнения
- Отслеживание состояния выполнения

### 5. WorkspacePanel
**Назначение:** Панель рабочей области для создания программ.

**Основные функции:**
- Управление блоками команд
- Отмена/повтор действий
- Подсчет команд

### 6. DropZone
**Назначение:** Зона для размещения блоков команд.

**Основные функции:**
- Прием блоков при перетаскивании
- Управление порядком блоков
- Отслеживание количества блоков

## Как работает система

1. **Инициализация:**
   - При запуске сцены инициализируются все менеджеры
   - Загружается текущий уровень
   - Инициализируется робот на стартовой позиции

2. **Создание программы:**
   - Игрок перетаскивает блоки команд из палитры в рабочую область
   - WorkspacePanel отслеживает количество и порядок блоков

3. **Выполнение программы:**
   - При нажатии "Старт" GameManager передает блоки ProgramInterpreter
   - ProgramInterpreter последовательно выполняет команды
   - RobotController выполняет каждую команду с анимацией

4. **Завершение уровня:**
   - При достижении цели LevelManager отмечает уровень как пройденный
   - Разблокируется следующий уровень
   - Показывается экран завершения

## Решение проблем

### Проблема: Игра остается на паузе при выходе в меню
**Решение:** Добавлен метод ResumeGame() который сбрасывает Time.timeScale = 1f

### Проблема: Утечка памяти при переходах
**Решение:** 
- Добавлены методы очистки слушателей событий (ClearEventListeners)
- Все события отписываются в OnDestroy и OnDisable
- Корутины останавливаются при уничтожении объектов

## Горячие клавиши для тестирования

- **F1** - Показать состояние всех систем
- **Пробел** - Старт/Стоп программы
- **R** - Сброс программы
- **Esc** - Пауза

## Рекомендации по использованию

1. **При разработке новых компонентов:**
   - Всегда отписывайтесь от событий в OnDestroy и OnDisable
   - Останавливайте корутины при уничтожении объектов
   - Используйте null-проверки для всех ссылок

2. **При добавлении новых команд:**
   - Создавайте наследников от CommandBlock
   - Реализуйте метод Execute с логикой команды
   - Добавьте локализацию названия команды

3. **При работе с UI:**
   - Используйте ClearEventListeners перед добавлением новых слушателей
   - Проверяйте существование компонентов перед использованием
   - Обновляйте визуальные элементы при изменении состояния